[
  {
    "objectID": "materials/accuracy/slides.html#section",
    "href": "materials/accuracy/slides.html#section",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tidy time series analysis and forecasting\n\n\nAccuracy evaluation\n\n\n24th June 2024 @ UM6P F4SG\n\nMitchell O’Hara-Wild, Nectric\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-r-medicine-2024"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-1",
    "href": "materials/accuracy/slides.html#section-1",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Evaluating models\n\n\n\n\n\n\nInspecting model errors\n\n\nAccurate models have small errors.\nGood models capture all patterns in the data.\nModel errors contain patterns not captured by the model!\n\n\n\n\n\nlibrary(fpp3)\npbs_scripts &lt;- PBS |&gt; \n  summarise(Scripts = sum(Scripts))\nfit &lt;- pbs_scripts |&gt; \n  model(\n    ETS(Scripts), \n    ARIMA(log(Scripts))\n  )\naugment(fit)"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-2",
    "href": "materials/accuracy/slides.html#section-2",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Evaluating models\n\n\n# A tsibble: 408 x 6 [1M]\n# Key:       .model [2]\n   .model          Month Scripts  .fitted   .resid  .innov\n   &lt;chr&gt;           &lt;mth&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;\n 1 ETS(Scripts) 1991 Jul 8090395 7730981.  359414.  0.0465\n 2 ETS(Scripts) 1991 Aug 7308118 8049721. -741603. -0.0921\n 3 ETS(Scripts) 1991 Sep 7614644 7923794. -309150. -0.0390\n 4 ETS(Scripts) 1991 Oct 8206248 8303919.  -97671. -0.0118\n 5 ETS(Scripts) 1991 Nov 7686634 8196083. -509449. -0.0622\n 6 ETS(Scripts) 1991 Dec 8954872 9171153. -216281. -0.0236\n 7 ETS(Scripts) 1992 Jan 9616464 9247886.  368578.  0.0399\n 8 ETS(Scripts) 1992 Feb 6291465 5807309.  484156.  0.0834\n 9 ETS(Scripts) 1992 Mar 6806613 7047332. -240719. -0.0342\n10 ETS(Scripts) 1992 Apr 7651435 7110362.  541073.  0.0761\n# i 398 more rows\n\n\n\n\n\n\n\n\nFitted values and residuals\n\n\n\n\\(\\hat{y}_t\\): 1-step in-sample fits (forecasts) are in .fitted\n\\(e_t\\): response (actual) errors are in .resid\n\\(\\varepsilon_t\\): innovation (model) errors are in .innov"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-3",
    "href": "materials/accuracy/slides.html#section-3",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Plotting in-sample fits\n\npbs_scripts |&gt; \n  autoplot(Scripts) + \n  autolayer(augment(fit), .fitted)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFitted values and response residuals\n\n\nThe response residuals are the difference between actual and predicted values: \\(e_t = y_t - \\hat{y}_t\\)."
  },
  {
    "objectID": "materials/accuracy/slides.html#section-4",
    "href": "materials/accuracy/slides.html#section-4",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Summarising model accuracy\nResponse residuals are often used to calculate accuracy ‘measures’.\nCommon accuracy measures can be calculated with accuracy().\n\naccuracy(fit)\n\n# A tibble: 2 x 10\n  .model           .type      ME   RMSE    MAE     MPE  MAPE  MASE RMSSE    ACF1\n  &lt;chr&gt;            &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;\n1 ETS(Scripts)     Trai~  26545. 6.11e5 4.71e5  0.0216  4.03 0.674 0.701 -0.324 \n2 ARIMA(log(Scrip~ Trai~ -76599. 6.15e5 4.46e5 -0.761   3.73 0.638 0.705 -0.0738"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-5",
    "href": "materials/accuracy/slides.html#section-5",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Summarising model accuracy\nThese point forecast accuracy measures are:\n\nME: Mean error (indicates bias)\nRMSE: Root mean squared error\n(forecast mean accuracy)\nMAE: Mean absolute error\n(forecast median accuracy)\nMPE/MAPE: Percentage errors (problematic, instead use…)\nMASE: Mean absolute scaled error\n(scaled median accuracy)"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-6",
    "href": "materials/accuracy/slides.html#section-6",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting accuracy\nEvaluating out-of-sample forecasts gives more realistic forecast accuracy results.\nFor this, we create a training dataset which withholds data for evaluating accuracy.\nThen, we produce forecasts from the model that overlap with the withheld ‘test’ data.\n\n\nfc &lt;- pbs_scripts |&gt; \n  # Keep some data for evaluating forecasts\n  filter(Month &lt; yearmonth(\"2006 Jan\")) |&gt; \n  model(\n    ETS(Scripts), \n    ARIMA(log(Scripts))\n  ) |&gt; \n  forecast(h = \"2 years\")"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-10",
    "href": "materials/accuracy/slides.html#section-10",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting accuracy\nThen we can again use accuracy() with our forecasts:\n\naccuracy(fc, pbs_scripts)\n\n# A tibble: 2 x 10\n  .model             .type      ME   RMSE    MAE    MPE  MAPE  MASE RMSSE   ACF1\n  &lt;chr&gt;              &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;\n1 ARIMA(log(Scripts~ Test   -1915. 8.32e5 6.88e5 -0.309  4.98  1.05  1.03 -0.453\n2 ETS(Scripts)       Test  -11280. 8.56e5 7.14e5 -0.539  5.19  1.09  1.06 -0.523\n\n\n\n\n\n\n\n\nInclude the data\n\n\nUnlike model accuracy, forecasts don’t know what the actual values are.\nYou need to pass in the full dataset to accuracy().\ni.e. accuracy(&lt;forecasts&gt;, &lt;full_data&gt;)."
  },
  {
    "objectID": "materials/accuracy/slides.html#section-11",
    "href": "materials/accuracy/slides.html#section-11",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting accuracy\n\n\n\n\n\n\nYour turn\n\n\nEvaluate ETS and ARIMA forecast accuracy of A10 scripts (pbs_a10).\n\nWithhold 2 years of data for forecast evaluation,\nEstimate ETS and ARIMA models on the filtered data,\nProduce forecasts for the 2 years of withheld data,\nEvaluate forecast accuracy using accuracy().\n\nWhich model is more accurate for forecasting?\nDoes this differ from the in-sample model accuracy?"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-12",
    "href": "materials/accuracy/slides.html#section-12",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting accuracy\n\n\n\n\n\n\nSmall sample problems!\n\n\nTest sets in time series can be problematic.\nHere we’re judging the best model based on just the most recent 2 years of data."
  },
  {
    "objectID": "materials/accuracy/slides.html#section-13",
    "href": "materials/accuracy/slides.html#section-13",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Cross-validation accuracy\nTo overcome this, we can use time-series cross-validation.\nThis creates many training sets from which we produce many forecasts from different starting points."
  },
  {
    "objectID": "materials/accuracy/slides.html#section-14",
    "href": "materials/accuracy/slides.html#section-14",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Cross-validation accuracy\nThe stretch_tsibble() function can be added after filter() to create time-series cross-validation folds of data.\n\n\nfc_cv &lt;- pbs_scripts |&gt; \n  # Keep some data for evaluating forecasts\n  filter(Month &lt; yearmonth(\"2006 Jan\")) |&gt; \n  # Cross-validate the remaining data\n  stretch_tsibble(.step = 24, .init = 48) |&gt; \n  model(\n    ETS(Scripts), \n    ARIMA(log(Scripts))\n  ) |&gt; \n  forecast(h = \"2 years\")"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-18",
    "href": "materials/accuracy/slides.html#section-18",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Cross-validation accuracy\nOnce more, we again use accuracy() with our forecasts:\n\naccuracy(fc_cv, pbs_scripts)\n\n# A tibble: 2 x 10\n  .model             .type      ME   RMSE    MAE    MPE  MAPE  MASE RMSSE   ACF1\n  &lt;chr&gt;              &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;\n1 ARIMA(log(Scripts~ Test  -88074. 7.53e5 5.76e5 -0.739  4.81 0.874 0.929 0.0810\n2 ETS(Scripts)       Test  125950. 8.11e5 6.22e5  0.827  5.06 0.944 1.00  0.185 \n\n\n\n\n\n\n\n\nYour turn\n\n\nCalculate cross-validated forecast accuracy on A10 Scripts (from pbs_a10).\nHow do these results differ from the forecast accuracy calculated earlier?"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-19",
    "href": "materials/accuracy/slides.html#section-19",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Residual diagnostics\n\naugment(fit)\n\n# A tsibble: 408 x 6 [1M]\n# Key:       .model [2]\n   .model          Month Scripts  .fitted   .resid  .innov\n   &lt;chr&gt;           &lt;mth&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;\n 1 ETS(Scripts) 1991 Jul 8090395 7730981.  359414.  0.0465\n 2 ETS(Scripts) 1991 Aug 7308118 8049721. -741603. -0.0921\n 3 ETS(Scripts) 1991 Sep 7614644 7923794. -309150. -0.0390\n 4 ETS(Scripts) 1991 Oct 8206248 8303919.  -97671. -0.0118\n 5 ETS(Scripts) 1991 Nov 7686634 8196083. -509449. -0.0622\n 6 ETS(Scripts) 1991 Dec 8954872 9171153. -216281. -0.0236\n 7 ETS(Scripts) 1992 Jan 9616464 9247886.  368578.  0.0399\n 8 ETS(Scripts) 1992 Feb 6291465 5807309.  484156.  0.0834\n 9 ETS(Scripts) 1992 Mar 6806613 7047332. -240719. -0.0342\n10 ETS(Scripts) 1992 Apr 7651435 7110362.  541073.  0.0761\n# i 398 more rows\n\n\nRecall the ‘innovation’ (model) residuals from augment(), .innov."
  },
  {
    "objectID": "materials/accuracy/slides.html#section-20",
    "href": "materials/accuracy/slides.html#section-20",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Residual diagnostics\n\n\n\n\n\n\nInnovation residuals\n\n\nInnovation residuals contain patterns that weren’t captured by the model.\nThey aren’t so useful for summarising accuracy since they might be transformed.\n\n\n\nWith .innov, we can use visualisation to look for patterns. Ideally we don’t find any because this means the model captured everything."
  },
  {
    "objectID": "materials/accuracy/slides.html#section-21",
    "href": "materials/accuracy/slides.html#section-21",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Residual diagnostics\nConsider a regression model without seasonality.\n\nfit &lt;- pbs_scripts |&gt; \n  model(TSLM(Scripts ~ trend()))\naugment(fit) |&gt; \n  gg_season(.innov)"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-22",
    "href": "materials/accuracy/slides.html#section-22",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Residual diagnostics\n\n\n\n\n\n\nPattern found - seasonality detected\n\n\nHere we can see that the seasonality wasn’t captured by this model, and can still be found in the residuals.\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nLook for any patterns in the residuals from your ARIMA and ETS models on A10 scripts.\n\nfit &lt;- pbs_a10 |&gt; \n  model(\n    ETS(Scripts),\n    ARIMA(log(Scripts))\n  )\naugment(fit)\n\n# A tsibble: 408 x 6 [1M]\n# Key:       .model [2]\n   .model          Month Scripts .fitted  .resid   .innov\n   &lt;chr&gt;           &lt;mth&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;\n 1 ETS(Scripts) 1991 Jul  113347 109098.   4249.  0.0389 \n 2 ETS(Scripts) 1991 Aug  103530 109333.  -5803. -0.0531 \n 3 ETS(Scripts) 1991 Sep  108772 112456.  -3684. -0.0328 \n 4 ETS(Scripts) 1991 Oct  121924 121089.    835.  0.00689\n 5 ETS(Scripts) 1991 Nov  120961 124109.  -3148. -0.0254 \n 6 ETS(Scripts) 1991 Dec  147928 159202. -11274. -0.0708 \n 7 ETS(Scripts) 1992 Jan  175199 165065.  10134.  0.0614 \n 8 ETS(Scripts) 1992 Feb   95018  93161.   1857.  0.0199 \n 9 ETS(Scripts) 1992 Mar   99984 103161.  -3177. -0.0308 \n10 ETS(Scripts) 1992 Apr  108356 106067.   2289.  0.0216 \n# i 398 more rows"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-23",
    "href": "materials/accuracy/slides.html#section-23",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Residual diagnostics\n\n\n\n\n\n\nChecking assumptions\n\n\nIt is good practice to check model assumptions.\nAll model’s we’ve seen today assume \\(\\varepsilon_t \\overset{\\mathrm{iid}}{\\sim} N(0, \\sigma^2)\\).\nTo check this, we can use gg_tsresiduals()."
  },
  {
    "objectID": "materials/accuracy/slides.html#section-24",
    "href": "materials/accuracy/slides.html#section-24",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Residual diagnostics\n\nfit |&gt; \n  select(`ETS(Scripts)`) |&gt; \n  gg_tsresiduals()"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-25",
    "href": "materials/accuracy/slides.html#section-25",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Residual diagnostics\n\nfit |&gt; \n  select(`ARIMA(log(Scripts))`) |&gt; \n  gg_tsresiduals()"
  },
  {
    "objectID": "materials/accuracy/slides.html#section-26",
    "href": "materials/accuracy/slides.html#section-26",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Ljung-Box tests\nTest whether whole set of \\(r_{k}\\) values (autocorrelations) is significantly different from zero set.\n\\[Q = T(T+2) \\sum_{k=1}^\\ell (T-k)^{-1}r_k^2\\] where \\(\\ell=\\) max lag and \\(T=\\) # observations.\n\nIf each \\(r_k\\) close to zero, \\(Q\\) will be small.\nIf some \\(r_k\\) values are large, \\(Q\\) will be large.\n\\(Q \\sim \\chi^2\\) with \\(\\ell\\) degrees of freedom."
  },
  {
    "objectID": "materials/accuracy/slides.html#thats-all-we-have-time-for",
    "href": "materials/accuracy/slides.html#thats-all-we-have-time-for",
    "title": "Tidy time series & forecasting in R",
    "section": "That’s all we have time for!",
    "text": "That’s all we have time for!\n\n\n\n\n\n\n\n\nLearn more about forecasting\n\n\n\nForecasting principles and practices textbook\n\nFreely available online! https://otexts.com/fpp3/\n\n\n\n\n\n\n\n\n\nI appreciate your feedback\n\n\nShort feedback form: https://feedback.nectric.com.au/oZyK\n\n\n\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-r-medicine-2024"
  },
  {
    "objectID": "materials/accuracy/slides.html#unsplash-credits",
    "href": "materials/accuracy/slides.html#unsplash-credits",
    "title": "Tidy time series & forecasting in R",
    "section": "Unsplash credits",
    "text": "Unsplash credits\n\n\n\n\n\n\n\nThanks to these Unsplash contributors for their photos"
  },
  {
    "objectID": "materials/modelling/slides.html#section",
    "href": "materials/modelling/slides.html#section",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tidy time series analysis and forecasting\n\n\nModelling and forecasting\n\n\n24th June 2024 @ UM6P F4SG\n\nMitchell O’Hara-Wild, Nectric\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-r-medicine-2024"
  },
  {
    "objectID": "materials/modelling/slides.html#section-1",
    "href": "materials/modelling/slides.html#section-1",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting can be difficult!\n\nMany forecasts are catastrophically wrong, and better described as ‘hopecasting’."
  },
  {
    "objectID": "materials/modelling/slides.html#section-2",
    "href": "materials/modelling/slides.html#section-2",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Which is easier to forecast?\n\ndaily electricity demand in 3 days time\ntiming of next Halley’s comet appearance\ntime of sunrise this day next year\nGoogle stock price tomorrow\nGoogle stock price in 6 months time\nmaximum temperature tomorrow\nexchange rate of $US/AUS next week\ntotal sales of drugs in Australian pharmacies next month"
  },
  {
    "objectID": "materials/modelling/slides.html#section-3",
    "href": "materials/modelling/slides.html#section-3",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Factors affecting forecastability\nSomething is easier to forecast if…\n\nwe have a good understanding of the factors that contribute to it,\nthere is lots of data available,\nthe forecasts cannot affect the thing we are trying to forecast,\nthere is relatively low natural/unexplainable random variation,\nthe future is somewhat similar to the past."
  },
  {
    "objectID": "materials/modelling/slides.html#section-4",
    "href": "materials/modelling/slides.html#section-4",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "How are good forecasts made?\nStatistically! (or computationally!)\n\nConsider possible futures for this series:"
  },
  {
    "objectID": "materials/modelling/slides.html#section-14",
    "href": "materials/modelling/slides.html#section-14",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "What makes forecasts good?\nGood forecasts…\n\n\nAre uncertain (probabilistic)\nUseful for decision making\nCapture patterns in the data\n\n\n\n\n\n\n\n\n\nGood forecasts aren’t necessarily accurate!\n\n\nUsually accuracy is important, but not always.\nForecasts (usually) assume that interventions won’t occur, e.g. COVID-19 measures."
  },
  {
    "objectID": "materials/modelling/slides.html#section-15",
    "href": "materials/modelling/slides.html#section-15",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Statistical forecasting notation\n\n\nThing to be forecast: \\(y_{T+h}\\).\nWhat we know: \\(y_1,\\dots,y_T\\).\nForecast distribution: \\({y}_{T+h|t} = y_{T+h} \\mid \\{y_1,y_2,\\dots,y_{T}\\}\\).\nPoint forecast: \\(\\hat{y}_{T+h|T} =\\text{E}[y_{T+h} \\mid y_1,\\dots,y_T]\\).\nForecast variance: \\(\\text{Var}[y_{t}  \\mid y_1,\\dots,y_T]\\)\nPrediction interval is a range of values of \\(y_{T+h}\\) with high probability."
  },
  {
    "objectID": "materials/modelling/slides.html#section-16",
    "href": "materials/modelling/slides.html#section-16",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\n\n\n\nYour turn\n\n\nHow would you forecast the number of PBS scripts dispensed in Australia? Put suggestions in the chat.\nHint: Consider the patterns seen in the data, and how math can mimic the trend, seasonality, etc."
  },
  {
    "objectID": "materials/modelling/slides.html#section-17",
    "href": "materials/modelling/slides.html#section-17",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe naive model\n\n\nSimply use the most recent observation."
  },
  {
    "objectID": "materials/modelling/slides.html#section-18",
    "href": "materials/modelling/slides.html#section-18",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe naive model\n\n\n\nForecasts: \\(\\hat{y}_{T+h|T} =y_T\\).\nConsequence of efficient market hypothesis.\n\n\npbs_scripts |&gt; \n  model(NAIVE(Scripts))\n\n# A mable: 1 x 1\n  `NAIVE(Scripts)`\n           &lt;model&gt;\n1          &lt;NAIVE&gt;"
  },
  {
    "objectID": "materials/modelling/slides.html#section-19",
    "href": "materials/modelling/slides.html#section-19",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe seasonal naive model\n\n\nUse the most recent ‘seasonal’ observation."
  },
  {
    "objectID": "materials/modelling/slides.html#section-20",
    "href": "materials/modelling/slides.html#section-20",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe seasonal naive model\n\n\n\nForecasts equal to last value from same season.\nForecasts: \\(\\hat{y}_{T+h|T} =y_{T+h-m(k+1)}\\), where \\(m=\\) seasonal period and \\(k\\) is the integer part of \\((h-1)/m\\).\n\n\npbs_scripts |&gt; \n  model(SNAIVE(Scripts))\n\n# A mable: 1 x 1\n  `SNAIVE(Scripts)`\n            &lt;model&gt;\n1          &lt;SNAIVE&gt;"
  },
  {
    "objectID": "materials/modelling/slides.html#section-21",
    "href": "materials/modelling/slides.html#section-21",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe naive with drift model\n\n\nExtrapolate a line between the first and last observation."
  },
  {
    "objectID": "materials/modelling/slides.html#section-22",
    "href": "materials/modelling/slides.html#section-22",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe naive with drift model\n\n\n\nForecasts equal to last value plus average change.\nForecasts:\n\n\\[\\begin{align*}\n\\hat{y}_{T+h|T} & =  y_{T} + \\frac{h}{T-1}\\sum_{t=2}^T (y_t-y_{t-1})\\\\\n                 & = y_T + \\frac{h}{T-1}(y_T -y_1).\n\\end{align*}\\]\n\nEquivalent to extrapolating a line drawn between first and last observations.\n\n\npbs_scripts |&gt; \n  model(NAIVE(Scripts ~ drift()))\n\n# A mable: 1 x 1\n  `NAIVE(Scripts ~ drift())`\n                     &lt;model&gt;\n1              &lt;RW w/ drift&gt;"
  },
  {
    "objectID": "materials/modelling/slides.html#section-23",
    "href": "materials/modelling/slides.html#section-23",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe seasonal naive with drift model\n\n\nExtrapolate between first and last with seasonality."
  },
  {
    "objectID": "materials/modelling/slides.html#section-24",
    "href": "materials/modelling/slides.html#section-24",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Some simple forecasting models\n\n\n\nThe naive with drift model\n\n\n\nForecasts equal to last seasonal value plus average change.\nForecasts:\n\n\\[\\begin{align*}\n\\hat{y}_{T+h|T} & =  y_{T+h-m(k+1)} + \\frac{h}{T-1}\\sum_{t=2}^T (y_t-y_{t-1})\\\\\n                 & = y_{T+h-m(k+1)} + \\frac{h}{T-1}(y_T -y_1).\n\\end{align*}\\]\n\npbs_scripts |&gt; \n  model(SNAIVE(Scripts ~ drift()))\n\n# A mable: 1 x 1\n  `SNAIVE(Scripts ~ drift())`\n                      &lt;model&gt;\n1           &lt;SNAIVE w/ drift&gt;"
  },
  {
    "objectID": "materials/modelling/slides.html#section-25",
    "href": "materials/modelling/slides.html#section-25",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Estimating a model\nModels are estimated using model():\n\npbs_scripts |&gt; \n  model(\n    NAIVE(Scripts),\n    SNAIVE(Scripts),\n    NAIVE(Scripts ~ drift()),\n    SNAIVE(Scripts ~ drift()),\n  )\n\n# A mable: 1 x 4\n  `NAIVE(Scripts)` `SNAIVE(Scripts)` `NAIVE(Scripts ~ drift())`\n           &lt;model&gt;           &lt;model&gt;                    &lt;model&gt;\n1          &lt;NAIVE&gt;          &lt;SNAIVE&gt;              &lt;RW w/ drift&gt;\n# i 1 more variable: `SNAIVE(Scripts ~ drift())` &lt;model&gt;\n\n\n\n\n\n\n\n\nThe mable\n\n\nA mable (model table) contains 1 row per time series, and 1 column for each specified model."
  },
  {
    "objectID": "materials/modelling/slides.html#section-26",
    "href": "materials/modelling/slides.html#section-26",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Producing forecasts\nForecasts are made using forecast():\n\npbs_scripts |&gt; \n  model(\n    NAIVE(Scripts),\n    SNAIVE(Scripts),\n    NAIVE(Scripts ~ drift()),\n    SNAIVE(Scripts ~ drift()),\n  ) |&gt; \n  forecast(h = \"2 years\")\n\n# A fable: 96 x 4 [1M]\n# Key:     .model [4]\n   .model            Month             Scripts    .mean\n   &lt;chr&gt;             &lt;mth&gt;              &lt;dist&gt;    &lt;dbl&gt;\n 1 NAIVE(Scripts) 2008 Jul N(1.2e+07, 2.2e+12) 12123769\n 2 NAIVE(Scripts) 2008 Aug N(1.2e+07, 4.4e+12) 12123769\n 3 NAIVE(Scripts) 2008 Sep N(1.2e+07, 6.6e+12) 12123769\n 4 NAIVE(Scripts) 2008 Oct N(1.2e+07, 8.8e+12) 12123769\n 5 NAIVE(Scripts) 2008 Nov N(1.2e+07, 1.1e+13) 12123769\n 6 NAIVE(Scripts) 2008 Dec N(1.2e+07, 1.3e+13) 12123769\n 7 NAIVE(Scripts) 2009 Jan N(1.2e+07, 1.5e+13) 12123769\n 8 NAIVE(Scripts) 2009 Feb N(1.2e+07, 1.8e+13) 12123769\n 9 NAIVE(Scripts) 2009 Mar   N(1.2e+07, 2e+13) 12123769\n10 NAIVE(Scripts) 2009 Apr N(1.2e+07, 2.2e+13) 12123769\n# i 86 more rows"
  },
  {
    "objectID": "materials/modelling/slides.html#section-27",
    "href": "materials/modelling/slides.html#section-27",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Producing forecasts\n\n\n# A fable: 96 x 4 [1M]\n# Key:     .model [4]\n   .model            Month             Scripts    .mean\n   &lt;chr&gt;             &lt;mth&gt;              &lt;dist&gt;    &lt;dbl&gt;\n 1 NAIVE(Scripts) 2008 Jul N(1.2e+07, 2.2e+12) 12123769\n 2 NAIVE(Scripts) 2008 Aug N(1.2e+07, 4.4e+12) 12123769\n 3 NAIVE(Scripts) 2008 Sep N(1.2e+07, 6.6e+12) 12123769\n 4 NAIVE(Scripts) 2008 Oct N(1.2e+07, 8.8e+12) 12123769\n 5 NAIVE(Scripts) 2008 Nov N(1.2e+07, 1.1e+13) 12123769\n 6 NAIVE(Scripts) 2008 Dec N(1.2e+07, 1.3e+13) 12123769\n 7 NAIVE(Scripts) 2009 Jan N(1.2e+07, 1.5e+13) 12123769\n 8 NAIVE(Scripts) 2009 Feb N(1.2e+07, 1.8e+13) 12123769\n 9 NAIVE(Scripts) 2009 Mar   N(1.2e+07, 2e+13) 12123769\n10 NAIVE(Scripts) 2009 Apr N(1.2e+07, 2.2e+13) 12123769\n# i 86 more rows\n\n\n\n\n\n\n\n\nThe fable\n\n\nA fable (forecast table) is like a tsibble, but with distributions for the forecasted variable."
  },
  {
    "objectID": "materials/modelling/slides.html#section-28",
    "href": "materials/modelling/slides.html#section-28",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Visualising forecasts\n\npbs_scripts |&gt; \n  model(\n    NAIVE(Scripts),\n    SNAIVE(Scripts),\n    NAIVE(Scripts ~ drift()),\n    SNAIVE(Scripts ~ drift()),\n  ) |&gt; \n  forecast(h = \"2 years\") |&gt; \n  autoplot(pbs_scripts)"
  },
  {
    "objectID": "materials/modelling/slides.html#section-29",
    "href": "materials/modelling/slides.html#section-29",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting with regression\nRegression can also forecast, use time as regressors for the response variable.\n\ntrend via the time index \\(t\\)\nseasonality via seasonal dummies \\(s_{it}\\)\n\n\\[y_t = \\beta_0 + \\beta_1 t + \\sum_{i=1}^m \\beta_{s_i} s_{it} + \\varepsilon_t\\]\n\n\n\n\n\n\nSpecifying time series linear models\n\n\nTSLM(y ~ trend() + season())"
  },
  {
    "objectID": "materials/modelling/slides.html#section-30",
    "href": "materials/modelling/slides.html#section-30",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting with regression\n\n\n\n\n\n\nSpecifying time series linear models\n\n\nTSLM(y ~ trend() + season())\n\n\n\n\n\n\n\n\n\nYour turn!\n\n\nProduce forecasts for A10 scripts using regression.\n\nlibrary(fpp3)\npbs_a10 &lt;- PBS |&gt; \n  filter(ATC2 == \"A10\") |&gt; \n  summarise(Scripts = sum(Scripts), Cost = sum(Cost))"
  },
  {
    "objectID": "materials/modelling/slides.html#section-31",
    "href": "materials/modelling/slides.html#section-31",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting with regression\nRegression can also incorporate other covariates. For example:\n\npbs_a10 |&gt;\n  model(\n    TSLM(Cost ~ trend() + season() + Scripts)\n  )\n\n# A mable: 1 x 1\n  `TSLM(Cost ~ trend() + season() + Scripts)`\n                                      &lt;model&gt;\n1                                      &lt;TSLM&gt;\n\n\n\n\n\n\n\n\nDifficult to forecast\n\n\nForecasting with regressors requires you to forecast the regressors too! Useful regressors are easily known, predictable, or controllable."
  },
  {
    "objectID": "materials/modelling/slides.html#section-32",
    "href": "materials/modelling/slides.html#section-32",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Exponential smoothing\nTime series patterns often change over time.\nThe fixed coefficients of regression is unsuitable for most time series.\nExponential smoothing (ETS) is similar to regression, but allows the ‘coefficients’ (states) to vary over time.\n\\[y_t = \\ell_{t-1} + b_{t-1} + s_{t-m} + \\varepsilon_t\\]\n\n\n\n\n\n\nSpecifying ETS models\n\n\nETS(y ~ error(\"A\") + trend(\"A\") + season(\"A\"))"
  },
  {
    "objectID": "materials/modelling/slides.html#section-33",
    "href": "materials/modelling/slides.html#section-33",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Exponential smoothing\nExponential smoothing also works for ‘multiplicative’ patterns.\nThis is where the variation grows proportionately to \\(\\ell_t\\).\nFor example, multiplicative seasonality:\n\\[y_t = (\\ell_{t-1} + b_{t-1})s_{t-m} + \\varepsilon_t\\]\n\n\n\n\n\n\nSpecifying ETS models\n\n\nETS(y ~ error(\"A\") + trend(\"A\") + season(\"M\"))"
  },
  {
    "objectID": "materials/modelling/slides.html#section-34",
    "href": "materials/modelling/slides.html#section-34",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Exponential smoothing\nThe best ETS model can be chosen automatically.\nSimply not specify the right side of the formula.\n\n\n\n\n\n\nSpecifying ETS models\n\n\nETS(y)\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nEstimate an ETS model for the pbs_a10 Scripts.\nDoes the automatic ETS model match the patterns you see in a time plot?"
  },
  {
    "objectID": "materials/modelling/slides.html#section-35",
    "href": "materials/modelling/slides.html#section-35",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ARIMA\nUnlike earlier models which directly describe trends and seasonality, ARIMA forecasts patterns using autocorrelations (ACFs).\n\n\n\n\n\n\nRecall the ACF plot\n\n\n\npbs_scripts |&gt; \n  ACF(Scripts) |&gt; \n  autoplot()"
  },
  {
    "objectID": "materials/modelling/slides.html#section-36",
    "href": "materials/modelling/slides.html#section-36",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ARIMA\nUnlike ETS, ARIMA can’t directly handle multiplicative patterns. In-fact ARMA requires stationary patterns.\nThis isn’t a problem though, since we have a transformational trick 🪄\n\n\\[\\log(x \\times y) = \\log(x) + \\log(y)\\]\nBefore we can use ARIMA, we need to transform our data to be additive."
  },
  {
    "objectID": "materials/modelling/slides.html#section-37",
    "href": "materials/modelling/slides.html#section-37",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ARIMA\nLog transform the data to make multiplicative patterns additive.\n\npbs_scripts |&gt; \n  autoplot(log(Scripts))"
  },
  {
    "objectID": "materials/modelling/slides.html#section-38",
    "href": "materials/modelling/slides.html#section-38",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ARIMA\nWith the appropriate transformation, we can now estimate an ARIMA model:\n\n\n\n\n\n\nSpecifying ARIMA models\n\n\nThese will use automatic ARIMA selection (often described as auto.arima()).\nARIMA(y), or ARIMA(log(y))\n\n\n\n\n\n\n\n\n\nOther transformations\n\n\nMultiplicative patterns aren’t always exactly multiplicative - for this we often use power transformations via box_cox(y, lambda).\nMore information: https://otexts.com/fpp3/transformations.html"
  },
  {
    "objectID": "materials/modelling/slides.html#section-39",
    "href": "materials/modelling/slides.html#section-39",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ARIMA\n\n\n\n\n\n\nYour turn\n\n\nIdentify if a transformation is necessary for the pbs_a10 scripts.\nThen estimate an automatically selected ARIMA model for this data.\nCompare ARIMA forecasts with the automatic ETS model, how do they differ?"
  },
  {
    "objectID": "materials/modelling/slides.html#section-40",
    "href": "materials/modelling/slides.html#section-40",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ETS vs ARIMA\nWhich model is better?\nIt depends!\n\n\n\n\n\n\n\nCapturing patterns\n\n\n\nBoth handle time varying trends and seasonality.\nETS directly captures multiplicative patterns.\nARIMA can forecast cyclical patterns."
  },
  {
    "objectID": "materials/modelling/slides.html#time-for-a-break",
    "href": "materials/modelling/slides.html#time-for-a-break",
    "title": "Tidy time series & forecasting in R",
    "section": "⏰ Time for a break!",
    "text": "⏰ Time for a break!\n\n\n\n\n\n\n\n\nUp next…\n\n\n\nLooking for patterns in residuals\nEvaluating forecast accuracy\nChoosing the best forecasts\n\n\n\n\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-r-medicine-2024"
  },
  {
    "objectID": "materials/modelling/slides.html#unsplash-credits",
    "href": "materials/modelling/slides.html#unsplash-credits",
    "title": "Tidy time series & forecasting in R",
    "section": "Unsplash credits",
    "text": "Unsplash credits\n\n\n\n\n\n\n\nThanks to these Unsplash contributors for their photos"
  },
  {
    "objectID": "materials/data/slides.html#section",
    "href": "materials/data/slides.html#section",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tidy time series analysis and forecasting\n\n\nTime series data\n\n\n20th June 2024 @ UM6P F4SG\n\nMitchell O’Hara-Wild, Nectric\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-f4sg-um6p"
  },
  {
    "objectID": "materials/data/slides.html#section-1",
    "href": "materials/data/slides.html#section-1",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Forecasting for Social Good\nThis workshop is part of the F4SG initiative.\nSpecial thanks to:\n\nProfessor Bahman Rostami-Tabar for leading F4SG (https://www.f4sg.org/)\nUM6P for coordinating and hosting\nInternational Institute of Forecasters (IIF) for funding the training"
  },
  {
    "objectID": "materials/data/slides.html#section-2",
    "href": "materials/data/slides.html#section-2",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "🎯 Today’s goals\n\n\n\nLearn about time series data.\nVisualise common time series patterns.\nUse decomposition modelling to explore patterns.\nLook at lots of data using time series features\n\n\n\n\n\n\n\n\n🌻 Expectations\n\n\n\nAsk relevant questions any time, Q&A during breaks.\nParticipate in exercises.\nBe kind and respectful.\nMake mistakes and learn!"
  },
  {
    "objectID": "materials/data/slides.html#section-3",
    "href": "materials/data/slides.html#section-3",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Mitchell O’Hara‑Wild\nMonash + Nectric\n @mitchelloharawild\n @mitchelloharawild\n\n👋 Welcome, who am I?\n\n🦘 From Australia! Sorry for my accent!\n🎓 PhD candidate at Monash University\n📊 Data consulting and workshops at Nectric\n📈 Specialised in time series analysis\n📦 Develops R packages (fable, vitae, etc.)\n🤒 Produced COVID-19 forecasts for Australia\n🤖 DIYs IoT devices for home automation\n🌱 Permaculturist (🐝, 🐣, 🍄, 🌞)"
  },
  {
    "objectID": "materials/data/slides.html#section-4",
    "href": "materials/data/slides.html#section-4",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "You!\nUM6P\n\n🙋 Hi, who are you?\nHands up if…\n\n\n🇲🇦 You live in Morocco\n📊 You’ve analysed data\n📈 You’ve worked with time series data before\n🔮 You know what a forecast is\n🧑‍💻 You’ve used R before"
  },
  {
    "objectID": "materials/data/slides.html#section-5",
    "href": "materials/data/slides.html#section-5",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tidy time series analysis\nThis workshop is about tidy time series in R.\n\nWe’ll be using these packages!\n\n\n\n\n\n\n\n\n\nInstall them all with install.packages(\"fpp3\")"
  },
  {
    "objectID": "materials/data/slides.html#section-6",
    "href": "materials/data/slides.html#section-6",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tidy time series packages\n# Data manipulation\nlibrary(dplyr)\n# Plotting functions\nlibrary(ggplot2)\n# Time and date manipulation\nlibrary(lubridate)\n# Time series class\nlibrary(tsibble)\n# Tidy time series data\nlibrary(tsibbledata)\n# Time series graphics and statistics\nlibrary(feasts)\n# Forecasting functions\nlibrary(fable)\n\n# All of the above\nlibrary(fpp3)"
  },
  {
    "objectID": "materials/data/slides.html#section-7",
    "href": "materials/data/slides.html#section-7",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Design of the forecast package\n\n\n\n\n\nForecasting individual time series\nRegular and infrequent observations (monthly, quarterly or annually)\nPoint forecasts and intervals\nConsistent with ts models\n\n\n\n\nDesign of the fable package\n\n\n\n\n\nForecasting many time series\nObservations at any time (sub-daily, irregular, monthly, etc.)\nForecast distributions\nConsistent with the tidyverse"
  },
  {
    "objectID": "materials/data/slides.html#section-8",
    "href": "materials/data/slides.html#section-8",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Time series data\n\nFour-yearly Olympic winning times\nAnnual Google profits\nQuarterly Australian beer production\nMonthly pharmaceutical subsidies\nWeekly retail sales\nDaily COVID-19 infections\nHourly electricity demand\nMinutely blood glucose measurements\nTime-stamped stock transaction data"
  },
  {
    "objectID": "materials/data/slides.html#section-9",
    "href": "materials/data/slides.html#section-9",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Time series data\nComes in all shapes and sizes!\nLike all data, we hope it’s tidy 🧹\n\n\n\n\n\n\n\nAll time series data contain…\n\n\n\nThe time of the observation (index)\nOne or more observations (measurements)\n\n\nSome datasets have identifying metadata,\n\nIdentifying variables for the series (key)"
  },
  {
    "objectID": "materials/data/slides.html#section-10",
    "href": "materials/data/slides.html#section-10",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "The tsibble data format\n\nA tsibble is a tibble for time series!\nThe quarterly visitors to Australia are found in the tourism dataset.\n\nlibrary(fpp3)\ntourism\n\n# A tsibble: 24,320 x 5 [1Q]\n# Key:       Region, State, Purpose [304]\n   Quarter Region   State           Purpose  Trips\n     &lt;qtr&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;\n 1 1998 Q1 Adelaide South Australia Business  135.\n 2 1998 Q2 Adelaide South Australia Business  110.\n 3 1998 Q3 Adelaide South Australia Business  166.\n 4 1998 Q4 Adelaide South Australia Business  127.\n 5 1999 Q1 Adelaide South Australia Business  137.\n 6 1999 Q2 Adelaide South Australia Business  200.\n 7 1999 Q3 Adelaide South Australia Business  169.\n 8 1999 Q4 Adelaide South Australia Business  134.\n 9 2000 Q1 Adelaide South Australia Business  154.\n10 2000 Q2 Adelaide South Australia Business  169.\n# i 24,310 more rows"
  },
  {
    "objectID": "materials/data/slides.html#section-11",
    "href": "materials/data/slides.html#section-11",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "# A tsibble: 24,320 x 5 [1Q]\n# Key:       Region, State, Purpose [304]\n   Quarter Region   State           Purpose  Trips\n     &lt;qtr&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;\n 1 1998 Q1 Adelaide South Australia Business  135.\n 2 1998 Q2 Adelaide South Australia Business  110.\n 3 1998 Q3 Adelaide South Australia Business  166.\n 4 1998 Q4 Adelaide South Australia Business  127.\n 5 1999 Q1 Adelaide South Australia Business  137.\n 6 1999 Q2 Adelaide South Australia Business  200.\n 7 1999 Q3 Adelaide South Australia Business  169.\n 8 1999 Q4 Adelaide South Australia Business  134.\n 9 2000 Q1 Adelaide South Australia Business  154.\n10 2000 Q2 Adelaide South Australia Business  169.\n# i 24,310 more rows\n\n\n\n\n\n\n\n\nColumn types\n\n\nIn this dataset, the column types are:\n\nindex variable: Quarter\nkey variable(s): Region, State, and Purpose\nmeasured variable(s): Trips"
  },
  {
    "objectID": "materials/data/slides.html#section-12",
    "href": "materials/data/slides.html#section-12",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "pedestrian\n\n# A tsibble: 66,037 x 5 [1h] &lt;Australia/Melbourne&gt;\n# Key:       Sensor [4]\n   Sensor         Date_Time           Date        Time Count\n   &lt;chr&gt;          &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;int&gt;\n 1 Birrarung Marr 2015-01-01 00:00:00 2015-01-01     0  1630\n 2 Birrarung Marr 2015-01-01 01:00:00 2015-01-01     1   826\n 3 Birrarung Marr 2015-01-01 02:00:00 2015-01-01     2   567\n 4 Birrarung Marr 2015-01-01 03:00:00 2015-01-01     3   264\n 5 Birrarung Marr 2015-01-01 04:00:00 2015-01-01     4   139\n 6 Birrarung Marr 2015-01-01 05:00:00 2015-01-01     5    77\n 7 Birrarung Marr 2015-01-01 06:00:00 2015-01-01     6    44\n 8 Birrarung Marr 2015-01-01 07:00:00 2015-01-01     7    56\n 9 Birrarung Marr 2015-01-01 08:00:00 2015-01-01     8   113\n10 Birrarung Marr 2015-01-01 09:00:00 2015-01-01     9   166\n# i 66,027 more rows\n\n\n\n\n\n\n\n\nYour turn!\n\n\nIn this dataset, which columns are:\n\nindex variable(s)?\nkey variable(s)?\nmeasured variable(s)?"
  },
  {
    "objectID": "materials/data/slides.html#section-13",
    "href": "materials/data/slides.html#section-13",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Representing time (the index)\nTime is surprisingly tricky to represent!\n\nfrequency\ngranularity\ntime zones\ncalendars\nleap years (and seconds?!)\nholidays\ncivil/absolute time\ntime periods"
  },
  {
    "objectID": "materials/data/slides.html#section-14",
    "href": "materials/data/slides.html#section-14",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Representing time (the index)\nCommon time index variables can be created with these functions:\n\n\n\n\n\nFrequency\nFunction\n\n\n\n\nAnnual\nstart:end\n\n\nQuarterly\nyearquarter()\n\n\nMonthly\nyearmonth()\n\n\nWeekly\nyearweek()\n\n\nDaily\nas_date(), ymd()\n\n\nSub-daily\nas_datetime()"
  },
  {
    "objectID": "materials/data/slides.html#section-15",
    "href": "materials/data/slides.html#section-15",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Creating a tsibble\n\nTidy the data into a long format\nAppropriately class the time variable\nConvert to tsibble with as_tibble(), identifying the index and key variable(s).\n\nFor example:\ndata |&gt; \n  mutate(time = yearmonth(time)) |&gt; \n  as_tsibble(index = time, key = country)"
  },
  {
    "objectID": "materials/data/slides.html#section-16",
    "href": "materials/data/slides.html#section-16",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Creating a tsibble: PBS\nThe Pharmaceutical Benefits Scheme (PBS) is the Australian drugs subsidy scheme.\n\nMany drugs bought from pharmacies are subsidised to allow more equitable access to modern drugs.\nThe cost to government is determined by the number and types of drugs purchased. Currently nearly 1% of GDP.\nThe total cost is budgeted based on forecasts of drug usage."
  },
  {
    "objectID": "materials/data/slides.html#section-17",
    "href": "materials/data/slides.html#section-17",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Creating a tsibble: PBS\n\n\n\n\n\n\nFollow along\n\n\nLet’s convert the PBS dataset into a tsibble.\n\nlibrary(fpp3)\nreadr::read_csv(\n  \"https://workshop.nectric.com.au/f4sg-um6p/data/pbs.csv\"\n)\n\n\n\n\n\n\n\n# A tibble: 67,596 x 9\n   Month      Concession   Type    ATC1  ATC1_desc ATC2  ATC2_desc Scripts  Cost\n   &lt;date&gt;     &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;\n 1 1991-07-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   18228 67877\n 2 1991-08-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   15327 57011\n 3 1991-09-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   14775 55020\n 4 1991-10-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   15380 57222\n 5 1991-11-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   14371 52120\n 6 1991-12-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   15028 54299\n 7 1992-01-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   11040 39753\n 8 1992-02-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   15165 54405\n 9 1992-03-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   16898 61108\n10 1992-04-01 Concessional Co-pay~ A     Alimenta~ A01   STOMATOL~   18141 65356\n# i 67,586 more rows"
  },
  {
    "objectID": "materials/data/slides.html#section-18",
    "href": "materials/data/slides.html#section-18",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Creating a tsibble: PBS\n\n\n\n\n\n\nIndex variables\n\n\nCosts are measured monthly, and stored in what column?\nWe use yearmonth(Month) to appropriately class the Month column as monthly data\n\n\n\n\n\n\n\n\n\n\nKey variables\n\n\nCosts are disaggregated by drug type (ATC1 x15 / ATC2 84), concession category (x2) and patient type (x2), giving \\(84\\times2\\times2=336\\) time series.\n\n\n\n\n\n\n\n\n\n\n\nFollow along\n\n\nUse mutate() and as_tsibble() to convert this data into a valid tsibble."
  },
  {
    "objectID": "materials/data/slides.html#section-19",
    "href": "materials/data/slides.html#section-19",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Manipulating time series data\nTidy time series data uses tidyverse tools!\n\n\n\n\n\n\nYour turn\n\n\nTry calculating the total monthly cost of “A10” prescriptions (ATC2 classification) in Australia with dplyr.\nHow do concessional subsidies compare to general subsidies?"
  },
  {
    "objectID": "materials/data/slides.html#section-20",
    "href": "materials/data/slides.html#section-20",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Manipulating time series data\nHowever there are some differences when working with time…\nThe time index is always preserved (implicit group_by()).\n\n\n\n\n\n\nGrouping across time\n\n\nSometimes you want to summarise over time.\nSummarising over all of time is no longer a time series, so first convert to a tibble with as_tibble().\nTo re-index by a new variable, use index_by()."
  },
  {
    "objectID": "materials/data/slides.html#section-21",
    "href": "materials/data/slides.html#section-21",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Manipulating time series data\n\n\n\n\n\n\nYour turn\n\n\nExplore the PBS dataset and create some useful summaries of the data, and some useful time series to report and forecast.\nSome suggestions:\n\nWhat is the most costly drug categories (ATC1) in Australia\nWhich specific drug category (ATC2) is dispensed the most?"
  },
  {
    "objectID": "materials/data/slides.html#onto-the-next-topic",
    "href": "materials/data/slides.html#onto-the-next-topic",
    "title": "Tidy time series & forecasting in R",
    "section": "⏰ Onto the next topic!",
    "text": "⏰ Onto the next topic!\n\n\n\n\n\n\n\n\nUp next…\n\n\n\nUnderstanding time series patterns\nVisualising time series data\n\n\n\n\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-f4sg-um6p"
  },
  {
    "objectID": "materials/data/slides.html#unsplash-credits",
    "href": "materials/data/slides.html#unsplash-credits",
    "title": "Tidy time series & forecasting in R",
    "section": "Unsplash credits",
    "text": "Unsplash credits\n\n\n\n\n\n\n\nThanks to these Unsplash contributors for their photos"
  },
  {
    "objectID": "index.html#course-overview",
    "href": "index.html#course-overview",
    "title": "Tidy time series & forecasting in R",
    "section": "Course Overview",
    "text": "Course Overview\nIt is common for organizations to collect huge amounts of data over time, and existing time series analysis tools are not always suitable to handle the scale, frequency and structure of the data collected. In this workshop, we will look at some packages and methods that have been developed to handle the analysis of large collections of time series.\nOn day 1, we will look at the tsibble data structure for flexibly managing collections of related time series. We will look at how to do data wrangling, data visualizations and exploratory data analysis. If time permits, we will explore feature-based methods to explore time series data in high dimensions. A similar feature-based approach can be used to identify anomalous time series within a collection of time series, or to cluster or classify time series. Primary packages for day 1 will be tsibble, lubridate and feasts (along with the tidyverse of course).\nDay 2 will be about forecasting. We will look at some classical time series models and how they are automated in the fable package. We will look at creating ensemble forecasts and hybrid forecasts, as well as some new forecasting methods that have performed well in large-scale forecasting competitions. Finally, we will look at forecast reconciliation, allowing millions of time series to be forecast in a relatively short time while accounting for constraints on how the series are related.\nThis workshop is part of the F4SG initiative and is supported by the IIF. The workshop will run in-person at UM6P in Rabat, Morocco in June 2024."
  },
  {
    "objectID": "index.html#learning-objectives",
    "href": "index.html#learning-objectives",
    "title": "Tidy time series & forecasting in R",
    "section": "Learning objectives",
    "text": "Learning objectives\nParticipants will learn:\n\nHow to wrangle time series data with familiar tidy tools.\nHow to compute time series features and visualize large collections of time series.\nHow to select a good forecasting algorithm for your time series.\nHow to ensure forecasts of a large collection of time series are coherent."
  },
  {
    "objectID": "index.html#instructor",
    "href": "index.html#instructor",
    "title": "Tidy time series & forecasting in R",
    "section": "Instructor",
    "text": "Instructor\n Mitchell O’Hara-Wild (he/him) is a PhD candidate at Monash University, creating new techniques and tools for forecasting large collections of time series with Rob Hyndman and George Athanasopoulos. He is the lead developer of the tidy time-series forecasting tools fable and feasts, and has co-developed the widely used forecast package since 2015. Mitchell also operates a data consultancy, and has worked on many forecasting projects that have supported decision making and planning for businesses and governments. He is an award-winning educator, and has taught applied forecasting at Monash University and various forecasting workshops around the world."
  },
  {
    "objectID": "index.html#required-equipment",
    "href": "index.html#required-equipment",
    "title": "Tidy time series & forecasting in R",
    "section": "Required equipment",
    "text": "Required equipment\nPlease bring your own laptop capable of running R."
  },
  {
    "objectID": "index.html#required-software",
    "href": "index.html#required-software",
    "title": "Tidy time series & forecasting in R",
    "section": "Required software",
    "text": "Required software\nTo be able to complete the exercises of this workshop, please install a suitable IDE (such as RStudio), a recent version of R (4.1+) and the following packages.\n\nTime series packages and extensions\n\nfpp3, sugrrants\n\ntidyverse packages and friends\n\ntidyverse, fpp3\n\n\nThe following code will install the main packages needed for the workshop.\ninstall.packages(c(\"tidyverse\",\"fpp3\", \"GGally\", \"sugrrants\"))\nPlease have the required software installed and pre-work completed before attending the workshop."
  },
  {
    "objectID": "feedback.html#feedback",
    "href": "feedback.html#feedback",
    "title": "Tidy time series & forecasting in R",
    "section": "Feedback",
    "text": "Feedback"
  },
  {
    "objectID": "license.html",
    "href": "license.html",
    "title": "License",
    "section": "",
    "text": "This work is licensed under a Creative Commons Attribution 4.0 International License."
  },
  {
    "objectID": "materials/graphics/slides.html#section",
    "href": "materials/graphics/slides.html#section",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tidy time series analysis and forecasting\n\n\nTime series patterns\n\n\n20th June 2024 @ UM6P F4SG\n\nMitchell O’Hara-Wild, Nectric\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-f4sg-um6p"
  },
  {
    "objectID": "materials/graphics/slides.html#section-1",
    "href": "materials/graphics/slides.html#section-1",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Visualising time series\nTime series visualisation helps us identify time series patterns.\nThese patterns include:\n\ntrends\nseasonalities\ncycles\ncovariates\nevents\n\nThey also help identify anomalies/outliers.\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#section-2",
    "href": "materials/graphics/slides.html#section-2",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Time plots\n\n\nThe most common time series graphic is the “time plot”, created with autoplot().\n\npbs_total &lt;- PBS |&gt;\n  summarise(Scripts = sum(Scripts), Cost = sum(Cost))\npbs_total |&gt;\n  autoplot(Scripts)"
  },
  {
    "objectID": "materials/graphics/slides.html#section-3",
    "href": "materials/graphics/slides.html#section-3",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Time plots\n\n\nTime plots show measurements on the y-axis with time on the x-axis.\nThey help identify long term patterns such as:\n\ntrends\nseasonality\nanomalies\n\nThey can help tell the story of the data.\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nUse autoplot() to create time plots for the measurements in aus_production."
  },
  {
    "objectID": "materials/graphics/slides.html#section-4",
    "href": "materials/graphics/slides.html#section-4",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Calendar plots\n\n\nA special type of time plot uses calendars.\n\nlibrary(sugrrants)\nvic_elec |&gt;\n  filter(year(Date) == 2014) |&gt;\n  mutate(Hour = hour(Time)) |&gt;\n  frame_calendar(x = Hour, y = Demand, date = Date, nrow = 4) |&gt;\n  ggplot(aes(x = .Hour, y = .Demand, group = Date)) +\n  geom_line() -&gt; p1\nprettify(p1, size = 3, label.padding = unit(0.15, \"lines\"))"
  },
  {
    "objectID": "materials/graphics/slides.html#section-5",
    "href": "materials/graphics/slides.html#section-5",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Calendar plots\n\n\nCalendar plots are especially useful for identifying daily changes in sub-daily data.\nExamples include:\n\npublic holidays\nnotable events.\n\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nCreate a calendar plot for the number of pedestrians outside Southern Cross Station in 2016."
  },
  {
    "objectID": "materials/graphics/slides.html#section-6",
    "href": "materials/graphics/slides.html#section-6",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Scatter plots\n\n\nCross-sectional visualisation can also be used to better understand time series.\n\npbs_total |&gt;\n  ggplot(aes(x = Scripts, y = Cost)) + \n  geom_point()\n\n\n\n\n\n\n\n\n\n\n\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#section-7",
    "href": "materials/graphics/slides.html#section-7",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Scatter plots\n\n\nScatter plots for time series don’t use time in any way for the visualisation. It compares two measurements, one on the x and y-axis.\nThey help identify relationships between variables, such as:\n\nlinearity\ndirection\nstrength\n\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nUse scatter plots to explore the relationships between measurements in aus_production.\n\n\n\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#section-8",
    "href": "materials/graphics/slides.html#section-8",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Seasonal plots\n\n\nThe gg_season() plots help identify peaks and troughs in seasonal patterns.\n\npbs_total |&gt;\n  gg_season(Scripts)"
  },
  {
    "objectID": "materials/graphics/slides.html#section-9",
    "href": "materials/graphics/slides.html#section-9",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Seasonal plots\n\n\nSeasonal plots show measurements on the y-axis with seasons on the x-axis and seasonal periods as colour.\nThey help identify details in seasonal patterns such as:\n\npeaks\ntroughs\n\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nUse gg_season() to identify the nature of seasonal patterns in aus_production."
  },
  {
    "objectID": "materials/graphics/slides.html#section-10",
    "href": "materials/graphics/slides.html#section-10",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Seasonal sub-series plots\n\n\nThe gg_subseries() plots help identify changes in seasonal patterns.\n\npbs_total |&gt;\n  gg_subseries(Scripts)\n\n\n\n\n\n\n\n\n\n\n\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#section-11",
    "href": "materials/graphics/slides.html#section-11",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Seasonal sub-series plots\n\n\nSeasonal plots show measurements on the y-axis with seasonal periods on the x-axis faceted by seasons. The blue line corresponds to the seasonal mean.\nThey help compare seasons, which is especially useful to see if and how the seasonal pattern changes over time.\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nUse gg_subseries() to explore the seasonal consistency in aus_production."
  },
  {
    "objectID": "materials/graphics/slides.html#section-12",
    "href": "materials/graphics/slides.html#section-12",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ACF plots\n\n\nThe ACF() |&gt; autoplot() plots identify all temporal patterns using autocorrelations.\n\npbs_total |&gt;\n  ACF(Scripts) |&gt; \n  autoplot()\n\n\n\n\n\n\n\n\n\n\n\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#section-13",
    "href": "materials/graphics/slides.html#section-13",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "ACF plots\n\n\nACF plots show autocorrelations on the y-axis, with the ACF lag on the x-axis.\nThe auto-correlation at lag \\(k\\) is:\n\\[r_k = \\text{cor}(y_t, y_{t-k}) = \\dfrac{\\sum(y_t - \\bar{y})(y_{t-k} - \\bar{y})}{\\sum(y_t - \\bar{y})^2}\\]\nACF plots show:\n\ntrend and unit roots via slow decay\nseasonality with peaks at seasonal periods\ncycles with increased correlation at cycle durations\n\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nUse ACF() and autoplot() to identify patterns in aus_production.\n\n\n\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#seasonal-or-cyclical",
    "href": "materials/graphics/slides.html#seasonal-or-cyclical",
    "title": "Tidy time series & forecasting in R",
    "section": "Seasonal or Cyclical?",
    "text": "Seasonal or Cyclical?\nThese common patterns are commonly confused, can you tell them apart?"
  },
  {
    "objectID": "materials/graphics/slides.html#section-14",
    "href": "materials/graphics/slides.html#section-14",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "White noise\n\nwn &lt;- tsibble(t = seq(36), y = rnorm(36), index = t)\nwn |&gt; autoplot(y)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDefinition\n\n\nWhite noise data is uncorrelated across time with zero mean and constant variance.\n(Technically, we require independence as well.)\n\n\n\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#section-15",
    "href": "materials/graphics/slides.html#section-15",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "White noise\nThe ACF is a useful way to identify if data is white noise. The blue dashed lines indicate 95% significance of the autocorrelation.\n\nwn |&gt; ACF(y) |&gt; autoplot()\n\n\n\n\n\n\n\n\n\n:::"
  },
  {
    "objectID": "materials/graphics/slides.html#time-for-a-break",
    "href": "materials/graphics/slides.html#time-for-a-break",
    "title": "Tidy time series & forecasting in R",
    "section": "⏰ Time for a break!",
    "text": "⏰ Time for a break!\n\n\n\n\n\n\n\n\nUp next…\n\n\n\nSimplifying patterns with transformations,\nDecomposing data to separate patterns.\n\n\n\n\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-f4sg-um6p"
  },
  {
    "objectID": "materials/graphics/slides.html#unsplash-credits",
    "href": "materials/graphics/slides.html#unsplash-credits",
    "title": "Tidy time series & forecasting in R",
    "section": "Unsplash credits",
    "text": "Unsplash credits\n\n\n\n\n\n\n\nThanks to these Unsplash contributors for their photos"
  },
  {
    "objectID": "materials/decomposition/slides.html#section",
    "href": "materials/decomposition/slides.html#section",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tidy time series analysis and forecasting\n\n\nTransforming and decomposing time series patterns\n\n\n20th June 2024 @ UM6P F4SG\n\nMitchell O’Hara-Wild, Nectric\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-f4sg-um6p"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-1",
    "href": "materials/decomposition/slides.html#section-1",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Transformations of time series\nTransformations use used in time series to:\n\nReveal actual underlying patterns\nSimplify the data to make modelling easier\n\n\n\n\n\n\n\nYour turn\n\n\nWhat are some useful transformations that you’ve seen used on data before?\nCan you think of transformations that would be useful for time series?"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-2",
    "href": "materials/decomposition/slides.html#section-2",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Population adjustment\n\nglobal_economy |&gt;\n  filter(Country == \"Australia\") |&gt;\n  autoplot(GDP)\n\n\n\n\n\n\n\n\nUseful in comparing populations of different size. Per capita adjustments are commonly used to compare GDP between countries."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-3",
    "href": "materials/decomposition/slides.html#section-3",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Population adjustment\n\nglobal_economy |&gt;\n  filter(Country == \"Australia\") |&gt;\n  autoplot(GDP/Population)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nYour turn\n\n\nModify the code to look at the GDP of multiple countries with vastly different populations."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-4",
    "href": "materials/decomposition/slides.html#section-4",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Inflation adjustment\n\n\n\n\n\n\n\n\n\nUseful in comparing economic series with different rates of inflation. This can be useful in comparing growth of different time series."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-5",
    "href": "materials/decomposition/slides.html#section-5",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Calendar days\n\nas_tsibble(USAccDeaths) |&gt;\n  gg_season(value)\n\n\n\n\n\n\n\n\nSometimes seasonal patterns are driven by simply having different durations of time in each season."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-6",
    "href": "materials/decomposition/slides.html#section-6",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Calendar days\n\nas_tsibble(USAccDeaths) |&gt;\n  gg_season(value/days_in_month(index))\n\n\n\n\n\n\n\n\nAdjusting to standardise this duration can simplify the pattern."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-7",
    "href": "materials/decomposition/slides.html#section-7",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Calendar days\n\n\n\n\n\n\nYour turn\n\n\nAdjust for the number of days in each month for the total PBS scripts. How does the seasonal pattern change when the duration of each month is adjusted for?\n\n\n\n\nPBS |&gt;\n  summarise(Scripts = sum(Scripts))"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-8",
    "href": "materials/decomposition/slides.html#section-8",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Mathematical transformations\nIf the data show different variation at different levels of the series, then a transformation can be useful.\n\n\n\n\n\n\nUseful transformations\n\n\nDenote original observations as \\(y_1,\\dots,y_n\\) and transformed observations as \\(w_1, \\dots, w_n\\).\n\nSquare root, \\(w_t = \\sqrt{y_t}\\)\nCube root, \\(w_t = \\sqrt[3]{y_t}\\)\nLogarithm, \\(w_t = \\text{log}(y_t)\\)\n\nLogarithms are particularly useful because they are more interpretable. Changes in a log value are relative (percent) changes on the original scale."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-9",
    "href": "materials/decomposition/slides.html#section-9",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Mathematical transformations\n\nfood &lt;- aus_retail |&gt;\n  filter(Industry == \"Food retailing\") |&gt;\n  summarise(Turnover = sum(Turnover))\nfood |&gt; autoplot(Turnover) +\n  labs(y = \"Turnover ($AUD)\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe growing seasonal variance is known as ‘multiplicative’ seasonality. It is very common for time series to do this."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-10",
    "href": "materials/decomposition/slides.html#section-10",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Mathematical transformations\n\nfood |&gt; autoplot(log(Turnover)) +\n  labs(y = \"Log-Turnover ($AUD)\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe variance in the seasonality is now regular."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-11",
    "href": "materials/decomposition/slides.html#section-11",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Box-Cox transformations\nEach of these transformations is close to a member of the family of Box-Cox transformations: \\[w_t = \\left\\{\\begin{array}{ll}\n        \\text{log}(y_t),      & \\quad \\lambda = 0; \\\\\n        (\\text{sign}(y_t)|y_t|^\\lambda-1)/\\lambda ,         & \\quad \\lambda \\ne 0.\n\\end{array}\\right.\\]\n\n\n\n\n\n\nCommon transformations\n\n\n\n\\(\\lambda=1\\): (No substantive transformation)\n\\(\\lambda=\\frac{1}{2}\\): (Square root plus linear transformation)\n\\(\\lambda=0\\): (Natural logarithm)\n\\(\\lambda=-1\\): (Inverse plus 1)"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-12",
    "href": "materials/decomposition/slides.html#section-12",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Box-Cox transformations\nThe \\(\\lambda\\) parameter can be automatically selected.\n\nfood |&gt;\n  features(Turnover, features = guerrero)\n\n# A tibble: 1 x 1\n  lambda_guerrero\n            &lt;dbl&gt;\n1          0.0895\n\n\n\n\nThis attempts to balance the seasonal fluctuations and random variation across the series.\nAlways check the results.\nA low value of \\(\\lambda\\) can give extremely large prediction intervals."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-13",
    "href": "materials/decomposition/slides.html#section-13",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Box-Cox transformations\n\nfood |&gt; autoplot(box_cox(Turnover, 0.0895)) +\n  labs(y = \"Box-Cox transformed turnover\")"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-14",
    "href": "materials/decomposition/slides.html#section-14",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Mathematical transformations\n\n\n\n\n\n\nUseful transformations\n\n\n\nOften no transformation needed.\nSimple transformations are easier to explain and work well enough.\nTransformations can have very large effect on forecasts.\nIf some data are zero or negative, then use \\(\\lambda&gt;0\\).\nlog1p() can also be useful for data with zeros.\nChoosing logs is a simple way to force forecasts to be positive\nTransformations must be reversed to obtain forecasts on the original scale. (Handled automatically by fable.)"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-15",
    "href": "materials/decomposition/slides.html#section-15",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Transformations\n\n\n\n\n\n\nYour turn\n\n\n\nFor the following series, find an appropriate transformation in order to simplify the patterns.\n\nUnited States GDP from global_economy\nSlaughter of Victorian “Bulls, bullocks and steers” in aus_livestock\nVictorian Electricity Demand from vic_elec.\nGas production from aus_production\n\nWhy is a Box-Cox transformation unhelpful for the canadian_gas data?"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-16",
    "href": "materials/decomposition/slides.html#section-16",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposition\nDecomposition is the process of spliting a time series into components, usually consisting of patterns in the data.\nThis is achieved by modelling the patterns, then extracting the contribution of those patterns in the model."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-17",
    "href": "materials/decomposition/slides.html#section-17",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposition\n\n\n\n\n\n\nAdditive decompositions\n\n\nToday we’ll learn about one useful type of decomposition: additive decomposition via STL.\nIt decomposes the:\n\nTrend-Cycle: aperiodic changes in level over time.\nSeasonality: periodic changes in level due to seasons (e.g., quarter of year, day of week, or hour of day).\nRemainder: unexplained changes not captured by other components.\n\n\\[y_t = S_t + T_t + R_t\\]\nwhere \\(y_t\\) is the data, \\(T_t\\) is the trend-cycle, \\(S_t\\) is the seasonality, and \\(R_t\\) is the remainder at time \\(t\\)."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-18",
    "href": "materials/decomposition/slides.html#section-18",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "STL Decomposition\nSTL is decomposes trend and seasonality using localised regression (loess).\n\n\n\n\n\n\n\nA lot to like\n\n\n\nVery versatile and robust.\nTrend and seasonality can change over time.\nRate of change (smoothness) controlled by user.\nOptionally robust to outliers.\n\n\n\n\n\n\n\n\n\n\n\n\nSome limitations\n\n\n\nNo trading day or calendar adjustments.\nOnly decomposes additive patterns."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-19",
    "href": "materials/decomposition/slides.html#section-19",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\nus_retail_employment &lt;- us_employment |&gt;\n  filter(year(Month) &gt;= 1990, Title == \"Retail Trade\") |&gt;\n  select(-Series_ID)\nus_retail_employment\n\n# A tsibble: 357 x 3 [1M]\n      Month Title        Employed\n      &lt;mth&gt; &lt;chr&gt;           &lt;dbl&gt;\n 1 1990 Jan Retail Trade   13256.\n 2 1990 Feb Retail Trade   12966.\n 3 1990 Mar Retail Trade   12938.\n 4 1990 Apr Retail Trade   13012.\n 5 1990 May Retail Trade   13108.\n 6 1990 Jun Retail Trade   13183.\n 7 1990 Jul Retail Trade   13170.\n 8 1990 Aug Retail Trade   13160.\n 9 1990 Sep Retail Trade   13113.\n10 1990 Oct Retail Trade   13185.\n# i 347 more rows"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-20",
    "href": "materials/decomposition/slides.html#section-20",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\nus_retail_employment |&gt;\n  autoplot(Employed) +\n  labs(y = \"Persons (thousands)\", title = \"Total employment in US retail\")"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-21",
    "href": "materials/decomposition/slides.html#section-21",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\ndcmp &lt;- us_retail_employment |&gt;\n  model(stl = STL(Employed))\ndcmp\n\n# A mable: 1 x 1\n      stl\n  &lt;model&gt;\n1   &lt;STL&gt;\n\n\nThis is an STL model fitted to the data. It’s stored in a mable (model table), and we’ll be seeing a lot more of these next week."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-22",
    "href": "materials/decomposition/slides.html#section-22",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\ncomponents(dcmp)\n\n# A dable: 357 x 7 [1M]\n# Key:     .model [1]\n# :        Employed = trend + season_year + remainder\n   .model    Month Employed  trend season_year remainder season_adjust\n   &lt;chr&gt;     &lt;mth&gt;    &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;\n 1 stl    1990 Jan   13256. 13288.      -33.0      0.836        13289.\n 2 stl    1990 Feb   12966. 13269.     -258.     -44.6          13224.\n 3 stl    1990 Mar   12938. 13250.     -290.     -22.1          13228.\n 4 stl    1990 Apr   13012. 13231.     -220.       1.05         13232.\n 5 stl    1990 May   13108. 13211.     -114.      11.3          13223.\n 6 stl    1990 Jun   13183. 13192.      -24.3     15.5          13207.\n 7 stl    1990 Jul   13170. 13172.      -23.2     21.6          13193.\n 8 stl    1990 Aug   13160. 13151.       -9.52    17.8          13169.\n 9 stl    1990 Sep   13113. 13131.      -39.5     22.0          13153.\n10 stl    1990 Oct   13185. 13110.       61.6     13.2          13124.\n# i 347 more rows"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-23",
    "href": "materials/decomposition/slides.html#section-23",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\ncomponents(dcmp) |&gt; autoplot()"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-24",
    "href": "materials/decomposition/slides.html#section-24",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\nus_retail_employment |&gt;\n  autoplot(Employed, color = \"gray\") +\n  autolayer(components(dcmp), trend, color = \"#D55E00\") +\n  labs(y = \"Persons (thousands)\", title = \"Total employment in US retail\")"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-25",
    "href": "materials/decomposition/slides.html#section-25",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\ncomponents(dcmp) |&gt; gg_subseries(season_year)"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-26",
    "href": "materials/decomposition/slides.html#section-26",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Seasonal adjustment\n\nUseful by-product of decomposition: an easy way to calculate seasonally adjusted data.\nAdditive decomposition: seasonally adjusted data given by \\[y_t - S_t = T_t + R_t\\]\nMultiplicative decomposition: seasonally adjusted data given by \\[y_t / S_t = T_t \\times R_t\\]"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-27",
    "href": "materials/decomposition/slides.html#section-27",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Seasonal adjustment\n\nWe use estimates of \\(S\\) based on past values to seasonally adjust a current value.\nSeasonally adjusted series reflect remainders as well as trend. Therefore they are not “smooth” and “downturns” or “upturns” can be misleading.\nIt is better to use the trend-cycle component to look for turning points."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-28",
    "href": "materials/decomposition/slides.html#section-28",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Decomposing US employment\n\ncomponents(dcmp) |&gt; \n  as_tsibble() |&gt;\n  autoplot(season_adjust)"
  },
  {
    "objectID": "materials/decomposition/slides.html#section-29",
    "href": "materials/decomposition/slides.html#section-29",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tuning STL decomposition\nIn many cases a decomposition can be improved by adjusting the default model parameters.\n\n\n\n\n\n\nIdeal decompositions\n\n\nA good decomposition will accurately separate the patterns. The window should be chosen such that the components are smooth, but not so smooth that their effects are seen in other components."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-30",
    "href": "materials/decomposition/slides.html#section-30",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "Tuning STL decomposition\nThere are many parameters that can adjust an STL decomposition, but the most useful one is the window size.\n\n\n\n\n\n\nComponent windows\n\n\nWindows control how quickly each component adapts to change.\n\ntrend(window = ?) controls wiggliness of trend component.\nseason(window = ?) controls variation on seasonal component.\nseason(window = 'periodic') is equivalent to an infinite window.\n\nA small window will react quickly to changes, and a large window will produce smoother components."
  },
  {
    "objectID": "materials/decomposition/slides.html#section-31",
    "href": "materials/decomposition/slides.html#section-31",
    "title": "Tidy time series & forecasting in R",
    "section": "",
    "text": "STL decomposition\n\n\n\n\n\n\nYour turn\n\n\n\nProduce the following decomposition\n\ncanadian_gas |&gt;\n  model(STL(Volume ~ season(window=7) + trend(window=11))) |&gt;\n  components() |&gt;\n  autoplot()\n\nWhat happens as you change the values of the two window arguments?\nHow does the seasonal shape change over time? [Hint: Try plotting the seasonal component using gg_season.]\nCan you produce a plausible seasonally adjusted series? [Hint: season_adjust is one of the variables returned by STL.]"
  },
  {
    "objectID": "materials/decomposition/slides.html#thats-all-for-today",
    "href": "materials/decomposition/slides.html#thats-all-for-today",
    "title": "Tidy time series & forecasting in R",
    "section": "⏰ That’s all for today!",
    "text": "⏰ That’s all for today!\n\n\n\n\n\n\n\n\nNext week…\n\n\n\nSpecifying time series models,\nTraining models on data,\nEvaluating model accuracy,\nForecasting the future!\n\n\n\n\n\n\n\n\n\n\n\nUseful links\n\n\n social.mitchelloharawild.com\n workshop.nectric.com.au/f4sg-um6p/\n mitchelloharawild/workshop-f4sg-um6p"
  },
  {
    "objectID": "materials/decomposition/slides.html#unsplash-credits",
    "href": "materials/decomposition/slides.html#unsplash-credits",
    "title": "Tidy time series & forecasting in R",
    "section": "Unsplash credits",
    "text": "Unsplash credits\n\n\n\n\n\n\n\nThanks to these Unsplash contributors for their photos"
  }
]